<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>中西合璧万年历 - 带黄历信息</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&family=Inter:wght@400;600&display=swap');
        
        body { font-family: 'Inter', 'Noto Serif SC', 'Microsoft YaHei', sans-serif; background: #f8fafc; color: #1e293b; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); }
        
        .day-card { 
            aspect-ratio: 1 / 1.3; 
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); 
            border: 1px solid #f1f5f9; 
            position: relative; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            background: white; 
            padding-top: 10px;
            cursor: pointer;
        }
        .day-card:hover { transform: translateY(-4px); z-index: 10; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); border-radius: 1rem; border-color: #fbbf24; }
        .is-today { background-color: #fffbeb; border: 2px solid #fbbf24 !important; border-radius: 1rem; }
        .day-selected { border: 2px solid #ef4444 !important; border-radius: 1rem; box-shadow: 0 0 15px rgba(239, 68, 68, 0.2); }
        
        .lunar-text { font-size: 0.7rem; color: #64748b; margin-top: 2px; }
        .fest-cn { color: #dc2626; font-weight: 700; font-size: 0.65rem; }
        .fest-es { color: #7c3aed; font-weight: 700; font-size: 0.65rem; }
        .term-text { color: #059669; font-weight: 700; font-size: 0.65rem; }
        
        .tag-cn { font-size: 0.5rem; color: #dc2626; border: 1px solid #fecaca; padding: 0 2px; border-radius: 2px; line-height: 1; }
        .tag-es { font-size: 0.5rem; color: #7c3aed; border: 1px solid #ddd6fe; padding: 0 2px; border-radius: 2px; line-height: 1; }
        
        .almanac-panel { background-image: radial-gradient(#fff 1px, transparent 1px); background-size: 20px 20px; }
        .yi { color: #059669; }
        .ji { color: #dc2626; }
        
        @media (max-width: 768px) {
            .main-layout { flex-direction: column; }
            .side-panel { width: 100% !important; border-left: none !important; border-top: 1px solid #e2e8f0; }
        }
    </style>
</head>
<body class="p-2 md:p-6 lg:p-10">

    <div class="max-w-7xl mx-auto bg-white rounded-[2rem] shadow-2xl overflow-hidden flex main-layout border border-slate-200">
        
        <!-- Left: Calendar Area -->
        <div class="flex-1 p-4 md:p-8">
            <!-- Header Controls -->
            <div class="flex flex-wrap justify-between items-center mb-8 gap-4">
                <div class="flex items-center gap-6">
                    <h1 id="currentMonthDisplay" class="text-4xl font-black text-slate-800 tracking-tighter">2026年 1月</h1>
                    <div class="flex bg-slate-100 p-1 rounded-xl">
                        <select id="yearSelect" class="bg-transparent border-none font-bold text-slate-600 focus:ring-0 cursor-pointer text-sm" onchange="jumpToDate()"></select>
                        <select id="monthSelect" class="bg-transparent border-none font-bold text-slate-600 focus:ring-0 cursor-pointer text-sm" onchange="jumpToDate()"></select>
                    </div>
                </div>
                <div class="flex items-center gap-3">
                    <button onclick="changeMonth(-1)" class="p-3 hover:bg-slate-100 rounded-full transition-all border border-slate-200">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg>
                    </button>
                    <button onclick="resetToToday()" class="px-6 py-2.5 bg-slate-800 text-white rounded-xl font-bold text-sm hover:bg-slate-700 shadow-md">今日</button>
                    <button onclick="changeMonth(1)" class="p-3 hover:bg-slate-100 rounded-full transition-all border border-slate-200">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>
                    </button>
                </div>
            </div>

            <!-- Week Header -->
            <div class="calendar-grid mb-2">
                <div class="py-2 text-center text-xs font-black text-red-500 uppercase">日</div>
                <div class="py-2 text-center text-xs font-black text-slate-400 uppercase">一</div>
                <div class="py-2 text-center text-xs font-black text-slate-400 uppercase">二</div>
                <div class="py-2 text-center text-xs font-black text-slate-400 uppercase">三</div>
                <div class="py-2 text-center text-xs font-black text-slate-400 uppercase">四</div>
                <div class="py-2 text-center text-xs font-black text-slate-400 uppercase">五</div>
                <div class="py-2 text-center text-xs font-black text-red-500 uppercase">六</div>
            </div>

            <!-- Days Container -->
            <div id="calendarDays" class="calendar-grid gap-1.5"></div>
        </div>

        <!-- Right: Almanac Panel -->
        <div id="sidePanel" class="w-[350px] bg-slate-50 border-l border-slate-100 p-8 almanac-panel overflow-y-auto">
            <div class="text-center mb-8">
                <div id="sideDate" class="text-6xl font-black text-slate-800 mb-2">12</div>
                <div id="sideMonthYear" class="text-slate-500 font-bold uppercase tracking-widest text-sm">January 2026</div>
                <div id="sideWeek" class="mt-4 inline-block px-4 py-1 bg-red-100 text-red-700 rounded-full text-xs font-black">星期一</div>
            </div>

            <div class="space-y-6">
                <!-- Lunar Info -->
                <div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-100">
                    <div class="text-xs font-black text-slate-400 mb-3 uppercase tracking-tighter flex justify-between">
                        <span>农历 LUNAR</span>
                        <span id="sideGZYear" class="text-red-600">乙巳年【蛇】</span>
                    </div>
                    <div id="sideLunarMain" class="text-2xl font-bold text-slate-800 mb-1">腊月初八</div>
                    <div id="sideGZFull" class="text-sm text-slate-500 font-medium">乙巳年 戊子月 辛丑日</div>
                </div>

                <!-- Yi / Ji -->
                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-emerald-50 p-5 rounded-2xl border border-emerald-100">
                        <div class="w-8 h-8 bg-emerald-500 text-white rounded-full flex items-center justify-center font-bold mb-3 shadow-lg shadow-emerald-200">宜</div>
                        <div id="sideYi" class="text-sm text-emerald-800 font-bold leading-relaxed space-y-1">祭祀 祈福 解除</div>
                    </div>
                    <div class="bg-rose-50 p-5 rounded-2xl border border-rose-100">
                        <div class="w-8 h-8 bg-rose-500 text-white rounded-full flex items-center justify-center font-bold mb-3 shadow-lg shadow-rose-200">忌</div>
                        <div id="sideJi" class="text-sm text-rose-800 font-bold leading-relaxed space-y-1">嫁娶 动土 开市</div>
                    </div>
                </div>

                <!-- Festival / Term Info -->
                <div id="sideFestivalBox" class="hidden bg-amber-50 p-5 rounded-2xl border border-amber-100">
                    <div class="text-xs font-black text-amber-600 mb-2">节日与节气 FESTIVALS</div>
                    <div id="sideFestivalsText" class="text-lg font-bold text-amber-900">腊八节 / 小寒</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 核心数据 (保持原样并优化)
        const LUNAR_INFO = [
            0x04bd8,0x04ae0,0x0a570,0x054d5,0x0d260,0x0d950,0x16554,0x056a0,0x09ad0,0x055d2,
            0x04ae0,0x0a5b6,0x0a4d0,0x0d250,0x1d255,0x0b540,0x0d6a0,0x0ada2,0x095b0,0x14977,
            0x04970,0x0a4b0,0x0b4b5,0x06a50,0x06d40,0x1ab54,0x02b60,0x09570,0x052f2,0x04970,
            0x06566,0x0d4a0,0x0ea50,0x06e95,0x05ad0,0x02b60,0x186e3,0x092e0,0x1c8d7,0x0c950,
            0x0d4a0,0x1d8a6,0x0b550,0x056a0,0x1a5b4,0x025d0,0x092d0,0x0d2b2,0x0a950,0x0b557,
            0x06ca0,0x0b550,0x15355,0x04da0,0x0a5d0,0x14573,0x052d0,0x0a9a8,0x0e950,0x06aa0,
            0x0aea6,0x0ab50,0x04b60,0x0aae4,0x0a570,0x05260,0x0f263,0x0d950,0x05b57,0x056a0,
            0x096d0,0x04dd5,0x04ad0,0x0a4d0,0x0d4d4,0x0d250,0x0d558,0x0b540,0x0b5a0,0x195a6,
            0x095b0,0x049b0,0x0a974,0x0a4b0,0x0b27a,0x06a50,0x06d40,0x0af46,0x0ab60,0x09570,
            0x04af5,0x04970,0x064b0,0x074a3,0x0ea50,0x06b58,0x055c0,0x0ab60,0x096d5,0x092e0,
            0x0c960,0x0d954,0x0d4a0,0x0da50,0x07552,0x056a0,0x0abb7,0x025d0,0x092d0,0x0cab5,
            0x0a950,0x0b4a0,0x0baa4,0x0ad50,0x055d9,0x04ba0,0x0a5b0,0x15176,0x052b0,0x0a930,
            0x07954,0x06aa0,0x0ad50,0x05b52,0x04b60,0x0a6e6,0x0a4e0,0x0d260,0x0ea65,0x0d530,
            0x05aa0,0x076a3,0x096d0,0x04bd7,0x04ad0,0x0a4d0,0x1d0b6,0x0d250,0x0d520,0x0dd45,
            0x0b5a0,0x056d0,0x055b2,0x049b0,0x0a577,0x0a4b0,0x0aa50,0x1b255,0x06d20,0x0ada0,
            0x14b63
        ];

        const T_GAN = ["甲", "乙", "丙", "丁", "戊", "己", "庚", "辛", "壬", "癸"];
        const D_ZHI = ["子", "丑", "寅", "卯", "辰", "巳", "午", "未", "申", "酉", "戌", "亥"];
        const SX = ["鼠", "牛", "虎", "兔", "龙", "蛇", "马", "羊", "猴", "鸡", "狗", "猪"];
        const SOLAR_TERMS = ["小寒", "大寒", "立春", "雨水", "惊蛰", "春分", "清明", "谷雨", "立夏", "小满", "芒种", "夏至", "小暑", "大暑", "立秋", "处暑", "白露", "秋分", "寒露", "霜降", "立冬", "小雪", "大雪", "冬至"];
        const LUNAR_MONTHS = ["正月", "二月", "三月", "四月", "五月", "六月", "七月", "八月", "九月", "十月", "冬月", "腊月"];
        const LUNAR_DAYS = ["初一", "初二", "初三", "初四", "初五", "初六", "初七", "初八", "初九", "初十", "十一", "十二", "十三", "十四", "十五", "十六", "十七", "十八", "十九", "二十", "廿一", "廿二", "廿三", "廿四", "廿五", "廿六", "廿七", "廿八", "廿九", "三十"];
        
        const ALMANAC_YI = ["祭祀", "祈福", "安门", "订婚", "纳采", "出行", "上梁", "修造", "安床", "扫舍", "入学", "立券", "栽种"];
        const ALMANAC_JI = ["嫁娶", "动土", "开市", "安葬", "掘井", "破土", "伐木", "词讼", "置产", "分居", "作灶", "纳畜"];

        const CN_SOLAR_FEST = {"1-1": "元旦", "5-1": "劳动节", "10-1": "国庆节"};
        const CN_LUNAR_FEST = {"1-1": "春节", "1-15": "元宵", "5-5": "端午", "8-15": "中秋", "9-9": "重阳", "12-8": "腊八", "12-23": "小年"};
        const ES_SOLAR_FEST = {"1-1": "Año Nuevo", "1-6": "Reyes Magos", "5-1": "Fiesta Trabajo", "8-15": "Asunción", "10-12": "Fiesta España", "11-1": "Todos Santos", "12-6": "Constitución", "12-8": "Inmaculada", "12-25": "Navidad"};

        const ST_DATA = [0, 21208, 42467, 63836, 85337, 107014, 128867, 150921, 173149, 195551, 218072, 240693, 263343, 285961, 308463, 330788, 352819, 374543, 395920, 416905, 437485, 457653, 477414, 496773];

        let viewDate = new Date();
        let selectedDate = new Date();

        function getEasterSunday(Y) {
            const a = Y % 19, b = Math.floor(Y / 100), c = Y % 100, d = Math.floor(b / 4), e = b % 4, f = Math.floor((b + 8) / 25), g = Math.floor((b - f + 1) / 3), h = (19 * a + b - d - g + 15) % 30, i = Math.floor(c / 4), k = c % 4, l = (32 + 2 * e + 2 * i - h - k) % 7, m = Math.floor((a + 11 * h + 22 * l) / 451);
            const month = Math.floor((h + l - 7 * m + 114) / 31);
            const day = ((h + l - 7 * m + 114) % 31) + 1;
            return new Date(Y, month - 1, day);
        }

        function getLunar(year, month, day) {
            let offset = (Date.UTC(year, month, day) - Date.UTC(1900, 0, 31)) / 86400000;
            let i, leap = 0, temp = 0;
            for (i = 1900; i < 2101 && offset > 0; i++) {
                temp = getLunarYearDays(i);
                offset -= temp;
            }
            if (offset < 0) { offset += temp; i--; }
            const lunarYear = i;
            leap = getLeapMonth(i);
            let isLeap = false;
            for (i = 1; i < 13 && offset > 0; i++) {
                if (leap > 0 && i === (leap + 1) && !isLeap) { --i; isLeap = true; temp = getLeapDays(lunarYear); }
                else { temp = getMonthDays(lunarYear, i); }
                if (isLeap && i === (leap + 1)) isLeap = false;
                offset -= temp;
            }
            if (offset < 0) { offset += temp; i--; }
            return { y: lunarYear, m: i, d: Math.floor(offset + 1), isLeap: isLeap };
        }

        function getLunarYearDays(y) {
            let i, sum = 348;
            for (i = 0x8000; i > 0x8; i >>= 1) sum += (LUNAR_INFO[y - 1900] & i) ? 1 : 0;
            return sum + getLeapDays(y);
        }
        function getLeapMonth(y) { return LUNAR_INFO[y - 1900] & 0xf; }
        function getLeapDays(y) { return getLeapMonth(y) ? ((LUNAR_INFO[y - 1900] & 0x10000) ? 30 : 29) : 0; }
        function getMonthDays(y, m) { return (LUNAR_INFO[y - 1900] & (0x10000 >> m)) ? 30 : 29; }
        function getTerm(y, n) {
            const offDate = new Date((31556925974.7 * (y - 1900) + ST_DATA[n] * 60000) + Date.UTC(1900, 0, 6, 2, 5));
            return offDate.getUTCDate();
        }

        function getGZ(year, month, day) {
            // 干支年
            const yearGZ = T_GAN[(year - 4) % 10] + D_ZHI[(year - 4) % 12];
            // 干支日 (1900-1-31是甲辰日)
            const offset = (Date.UTC(year, month, day) - Date.UTC(1900, 0, 31)) / 86400000;
            const dayGZIdx = (offset + 40) % 60;
            const dayGZ = T_GAN[dayGZIdx % 10] + D_ZHI[dayGZIdx % 12];
            return { year: yearGZ, day: dayGZ };
        }

        function initSelectors() {
            const ys = document.getElementById('yearSelect');
            const ms = document.getElementById('monthSelect');
            for (let i = 1920; i <= 2080; i++) {
                const opt = new Option(i + "Y", i);
                if (i === viewDate.getFullYear()) opt.selected = true;
                ys.add(opt);
            }
            for (let i = 0; i < 12; i++) {
                const opt = new Option((i + 1) + "M", i);
                if (i === viewDate.getMonth()) opt.selected = true;
                ms.add(opt);
            }
        }

        function selectDay(y, m, d) {
            selectedDate = new Date(y, m, d);
            updateAlmanac();
            render();
        }

        function updateAlmanac() {
            const y = selectedDate.getFullYear();
            const m = selectedDate.getMonth();
            const d = selectedDate.getDate();
            const lunar = getLunar(y, m, d);
            const gz = getGZ(y, m, d);
            const sx = SX[(y - 4) % 12];

            document.getElementById('sideDate').innerText = d;
            document.getElementById('sideMonthYear').innerText = selectedDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
            document.getElementById('sideWeek').innerText = "星期" + ["日", "一", "二", "三", "四", "五", "六"][selectedDate.getDay()];
            
            document.getElementById('sideGZYear').innerText = `${gz.year}年【${sx}】`;
            document.getElementById('sideLunarMain').innerText = `${LUNAR_MONTHS[lunar.m-1]}${LUNAR_DAYS[lunar.d-1]}`;
            document.getElementById('sideGZFull').innerText = `${gz.year}年 ${gz.day}日`;

            // 伪随机宜忌 (基于日期种子)
            const seed = (y + m + d) % ALMANAC_YI.length;
            const seedJi = (y * m * d) % ALMANAC_JI.length;
            document.getElementById('sideYi').innerText = ALMANAC_YI.slice(seed, seed + 3).join(' ');
            document.getElementById('sideJi').innerText = ALMANAC_JI.slice(seedJi, seedJi + 3).join(' ');

            // 节日/节气显示
            const cnSol = CN_SOLAR_FEST[`${m + 1}-${d}`];
            let cnLun = CN_LUNAR_FEST[`${lunar.m}-${lunar.d}`];
            let term = null;
            for (let i = 0; i < 24; i++) if (Math.floor(i / 2) === m && getTerm(y, i) === d) term = SOLAR_TERMS[i];
            
            if (cnSol || cnLun || term) {
                document.getElementById('sideFestivalBox').classList.remove('hidden');
                document.getElementById('sideFestivalsText').innerText = [cnSol, cnLun, term].filter(Boolean).join(' / ');
            } else {
                document.getElementById('sideFestivalBox').classList.add('hidden');
            }
        }

        function render() {
            const y = viewDate.getFullYear();
            const m = viewDate.getMonth();
            document.getElementById('currentMonthDisplay').innerText = `${y}年 ${m + 1}月`;
            
            const firstDay = new Date(y, m, 1).getDay();
            const lastDate = new Date(y, m + 1, 0).getDate();
            const prevLastDate = new Date(y, m, 0).getDate();
            
            const container = document.getElementById('calendarDays');
            container.innerHTML = '';

            const terms = {};
            for (let i = 0; i < 24; i++) if (Math.floor(i / 2) === m) terms[getTerm(y, i)] = SOLAR_TERMS[i];

            const easter = getEasterSunday(y);
            const holyFriday = new Date(easter); holyFriday.setDate(easter.getDate() - 2);

            for (let i = firstDay; i > 0; i--) createDay(prevLastDate - i + 1, true);

            const today = new Date();
            for (let d = 1; d <= lastDate; d++) {
                const lunar = getLunar(y, m, d);
                const isToday = today.getFullYear() === y && today.getMonth() === m && today.getDate() === d;
                const isSelected = selectedDate.getFullYear() === y && selectedDate.getMonth() === m && selectedDate.getDate() === d;
                
                const cnSol = CN_SOLAR_FEST[`${m + 1}-${d}`];
                const esSol = ES_SOLAR_FEST[`${m + 1}-${d}`];
                let cnLun = CN_LUNAR_FEST[`${lunar.m}-${lunar.d}`];
                if (lunar.m === 12) {
                    const next = getLunar(y, m, d + 1);
                    if (next.m === 1 && next.d === 1) cnLun = "除夕";
                }

                let esRel = null;
                const cur = new Date(y, m, d);
                if (cur.getTime() === holyFriday.getTime()) esRel = "Viernes Santo";
                if (cur.getTime() === easter.getTime()) esRel = "Pascua";

                const term = terms[d];
                const dow = new Date(y, m, d).getDay();

                createDay(d, false, isToday, isSelected, term, cnSol || cnLun, esSol || esRel, dow, lunar, y, m);
            }

            const remaining = 42 - (firstDay + lastDate);
            for (let i = 1; i <= remaining; i++) createDay(i, true);
        }

        function createDay(d, isPad, isToday, isSelected, term, cnFest, esFest, dow, lunar, y, m) {
            const div = document.createElement('div');
            div.className = `day-card ${isPad ? 'opacity-20 pointer-events-none' : ''} ${isToday ? 'is-today' : ''} ${isSelected ? 'day-selected' : ''}`;
            if (!isPad) {
                if (dow === 0 || dow === 6) div.classList.add('text-red-500');
                div.onclick = () => selectDay(y, m, d);
            }

            let html = `<span class="text-xl font-black">${d}</span>`;
            
            let tags = "";
            if (cnFest) tags += `<span class="tag-cn">中</span>`;
            if (esFest) tags += `<span class="tag-es">西</span>`;
            if (tags) html += `<div class="flex gap-0.5 mt-0.5">${tags}</div>`;

            if (cnFest) html += `<span class="fest-cn">${cnFest}</span>`;
            else if (esFest) html += `<span class="fest-es">${esFest}</span>`;
            else if (term) html += `<span class="term-text">${term}</span>`;
            else if (lunar) html += `<span class="lunar-text">${lunar.d === 1 ? LUNAR_MONTHS[lunar.m - 1] : LUNAR_DAYS[lunar.d - 1]}</span>`;

            div.innerHTML = html;
            document.getElementById('calendarDays').appendChild(div);
        }

        function changeMonth(v) { viewDate.setMonth(viewDate.getMonth() + v); updateSelectors(); render(); }
        function jumpToDate() {
            viewDate = new Date(document.getElementById('yearSelect').value, document.getElementById('monthSelect').value, 1);
            render();
        }
        function updateSelectors() {
            document.getElementById('yearSelect').value = viewDate.getFullYear();
            document.getElementById('monthSelect').value = viewDate.getMonth();
        }
        function resetToToday() { viewDate = new Date(); selectedDate = new Date(); updateSelectors(); updateAlmanac(); render(); }

        window.onload = () => { initSelectors(); updateAlmanac(); render(); };
    </script>
</body>
</html>
